<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monthly Closure Amusement</title>
<style>
  body { font-family: Arial, sans-serif; background: #f0f2f5; padding: 20px; color: #333; }
  h1 { text-align: center; color: #2c3e50; }
  .container { max-width: 900px; margin: auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
  table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background: #3498db; color: #fff; }
  input[type="text"], input[type="number"], input[type="date"] { width: 100%; padding: 6px; box-sizing: border-box; border-radius: 4px; border: 1px solid #ccc; }
  button { background: #27ae60; color: #fff; border: none; padding: 10px 15px; font-size: 16px; border-radius: 5px; cursor: pointer; margin-top: 10px; }
  button:hover { background: #1e8449; }
  .result { margin-top: 20px; background: #ecf0f1; padding: 15px; border-radius: 5px; }
  .expenses, .date-section { margin-top: 15px; }
</style>
</head>
<body>
<div class="container">
  <h1>Monthly Closure Amusement</h1>

  <div class="date-section">
    <label>Select Date:</label>
    <input type="date" id="closureDate">
  </div>

  <h2>25% Each Table</h2>
  <table id="table25">
    <thead>
      <tr><th>Store Name</th><th>Collection ($)</th><th>Action</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <button id="addRow25">Add Row to 25% Table</button>

  <h2>20-30% Table</h2>
  <table id="table20_30">
    <thead>
      <tr><th>Store Name</th><th>Collection ($)</th><th>Action</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <button id="addRow20_30">Add Row to 20-30% Table</button>

  <h2>Expenses</h2>
  <div class="expenses">
    <label>Santosh Expenses ($):</label><input type="number" id="expenseSantosh" value="0">
    <label>Atmaram Expenses ($):</label><input type="number" id="expenseAtmaram" value="0">
    <label>Jaya Expenses ($):</label><input type="number" id="expenseJaya" value="0">
    <label>Bijay Expenses ($):</label><input type="number" id="expenseBijay" value="0">
  </div>

  <button id="calcTotals">Calculate Totals</button>
  <button id="downloadPDF">Download PDF</button>

  <div class="result" id="result" style="display:none;">
    <h2>Final Totals</h2>
    <p id="totalSantosh"></p>
    <p id="totalAtmaram"></p>
    <p id="totalJaya"></p>
    <p id="totalBijay"></p>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
document.getElementById('closureDate').value = new Date().toISOString().split('T')[0];
let totals = {};

function addRow(tableId){
  const tbody=document.getElementById(tableId).querySelector('tbody');
  const row=document.createElement('tr');
  const cell1=document.createElement('td');
  const inputName=document.createElement('input'); inputName.type='text'; inputName.placeholder='Store Name';
  cell1.appendChild(inputName);
  const cell2=document.createElement('td');
  const inputCollection=document.createElement('input'); inputCollection.type='number'; inputCollection.value=0;
  cell2.appendChild(inputCollection);
  const cell3=document.createElement('td');
  const delBtn=document.createElement('button'); delBtn.innerText='Delete';
  delBtn.addEventListener('click',()=>row.remove());
  cell3.appendChild(delBtn);
  row.appendChild(cell1); row.appendChild(cell2); row.appendChild(cell3); tbody.appendChild(row);
}

document.getElementById('addRow25').addEventListener('click',()=>addRow('table25'));
document.getElementById('addRow20_30').addEventListener('click',()=>addRow('table20_30'));
document.getElementById('calcTotals').addEventListener('click',calculateTotals);
document.getElementById('downloadPDF').addEventListener('click',downloadPDF);

function getTableData(tableId){
  const data=[];
  const tbody=document.getElementById(tableId).querySelector('tbody');
  tbody.querySelectorAll('tr').forEach(r=>{
    const name=r.cells[0].querySelector('input').value||'';
    const col=parseFloat(r.cells[1].querySelector('input').value)||0;
    data.push({name,col});
  });
  return data;
}

function calculateTotals(){
  const expenses={
    santosh:parseFloat(document.getElementById('expenseSantosh').value)||0,
    atmaram:parseFloat(document.getElementById('expenseAtmaram').value)||0,
    jaya:parseFloat(document.getElementById('expenseJaya').value)||0,
    bijay:parseFloat(document.getElementById('expenseBijay').value)||0
  };

  const table25Data=getTableData('table25');
  const table20_30Data=getTableData('table20_30');

  let table25=table25Data.reduce((a,b)=>a+b.col,0);
  let table20_30=table20_30Data.reduce((a,b)=>a+b.col,0);

  function deductExpense(amount){
    if(amount===0) return 0;
    if(table25>=amount){ table25-=amount; return 0; }
    else{ let remaining=amount-table25; table25=0; if(table20_30>=remaining){ table20_30-=remaining; return 0; } else{ remaining-=table20_30; table20_30=0; return remaining; } }
  }

  deductExpense(expenses.santosh);
  deductExpense(expenses.atmaram);
  deductExpense(expenses.jaya);
  deductExpense(expenses.bijay);

  let table1Shares={santosh:table25*0.25, atmaram:table25*0.25, jaya:table25*0.25, bijay:table25*0.25};
  let table2Shares={santosh:table20_30*0.2, atmaram:table20_30*0.2, jaya:table20_30*0.3, bijay:table20_30*0.3};

  const santosh=table1Shares.santosh+table2Shares.santosh+expenses.santosh;
  const atmaram=table1Shares.atmaram+table2Shares.atmaram+expenses.atmaram;
  const jaya=table1Shares.jaya+table2Shares.jaya+expenses.jaya;
  const bijay=table1Shares.bijay+table2Shares.bijay+expenses.bijay;

  document.getElementById('totalSantosh').innerText="Santosh Total: $"+santosh.toFixed(2);
  document.getElementById('totalAtmaram').innerText="Atmaram Total: $"+atmaram.toFixed(2);
  document.getElementById('totalJaya').innerText="Jaya Total: $"+jaya.toFixed(2);
  document.getElementById('totalBijay').innerText="Bijay Total: $"+bijay.toFixed(2);

  document.getElementById('result').style.display='block';

  totals={santosh,atmaram,jaya,bijay,table25Data,table20_30Data,expenses};
}

function downloadPDF(){
  if(Object.keys(totals).length===0){ alert("Please calculate totals first!"); return; }
  const { jsPDF }=window.jspdf;
  const doc=new jsPDF();
  const dateInput=document.getElementById('closureDate').value;

  doc.setFontSize(16); doc.text("Monthly Closure Amusement",14,14);
  doc.setFontSize(12); doc.text("Date: "+dateInput,14,22);

  let y=30;
  function addTable(title,data){
    doc.setFontSize(13); doc.text(title,14,y); y+=6;
    doc.setFontSize(12);
    doc.text("Store Name",14,y); doc.text("Collection ($)",80,y); y+=5;
    data.forEach(d=>{ doc.text(d.name,14,y); doc.text(d.col.toFixed(2),80,y); y+=5; });
    y+=5;
  }

  addTable("25% Table",totals.table25Data);
  addTable("20-30% Table",totals.table20_30Data);

  y+=5; doc.setFontSize(13); doc.text("Expenses:",14,y); y+=6;
  doc.setFontSize(12);
  doc.text("Santosh: $"+totals.expenses.santosh.toFixed(2),14,y); y+=5;
  doc.text("Atmaram: $"+totals.expenses.atmaram.toFixed(2),14,y); y+=5;
  doc.text("Jaya: $"+totals.expenses.jaya.toFixed(2),14,y); y+=5;
  doc.text("Bijay: $"+totals.expenses.bijay.toFixed(2),14,y); y+=8;

  doc.setFontSize(13); doc.text("Final Amounts:",14,y); y+=6;
  doc.setFontSize(12);
  doc.text("Santosh: $"+totals.santosh.toFixed(2),14,y); y+=5;
  doc.text("Atmaram: $"+totals.atmaram.toFixed(2),14,y); y+=5;
  doc.text("Jaya: $"+totals.jaya.toFixed(2),14,y); y+=5;
  doc.text("Bijay: $"+totals.bijay.toFixed(2),14,y); y+=5;

  doc.save("Monthly_Closure_"+dateInput+".pdf");
}
</script>
</body>
</html>